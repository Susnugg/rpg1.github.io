<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>THE DRY WORLD - AI RPG</title>
    <style>
        body { background: #1a0f00; color: #d4a373; font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        #game-window { width: 90%; max-width: 800px; height: 90%; border: 2px solid #6b4423; background: #000; display: flex; flex-direction: column; box-shadow: 0 0 30px #4e342e; }
        
        /* Creator Screen */
        #creator-screen { padding: 40px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; }
        .creator-title { font-size: 28px; color: #ff6600; text-align: center; text-transform: uppercase; letter-spacing: 4px; margin-bottom: 5px; }
        .sub-title { text-align: center; font-size: 13px; color: #8a6d4d; margin-bottom: 20px; }
        
        .field-label { font-weight: bold; color: #ff9933; margin-bottom: 5px; display: block; }
        input[type="text"], input[type="password"], select { 
            width: 100%; background: #111; border: 1px solid #4e342e; color: #d4a373; padding: 12px; box-sizing: border-box; outline: none;
        }
        input:focus { border-color: #ff6600; }
        
        /* Main Game Screen */
        #main-game { display: none; flex-direction: column; height: 100%; }
        #output { flex-grow: 1; overflow-y: auto; padding: 25px; line-height: 1.7; border-bottom: 1px solid #333; font-size: 16px; }
        #input-container { padding: 15px; display: flex; gap: 10px; background: #0a0a0a; }
        #user-input { flex-grow: 1; background: #000; border: 1px solid #ff6600; color: #fff; padding: 12px; outline: none; }
        
        .btn-start { background: #ff6600; color: #000; border: none; padding: 15px; font-weight: bold; cursor: pointer; text-transform: uppercase; margin-top: 10px; }
        .btn-start:hover { background: #fff; }
        
        .user-text { color: #5bc0de; font-weight: bold; margin: 15px 0; padding-left: 10px; border-left: 3px solid #5bc0de; }
        .ai-text { margin-bottom: 25px; color: #d4a373; }
        .system-msg { color: #775533; font-style: italic; font-size: 12px; }
    </style>
</head>
<body>

<div id="game-window">
    <div id="creator-screen">
        <div class="creator-title">The Dry World</div>
        <div class="sub-title">Water is a memory. Dust is the law.</div>
        
        <div class="field">
            <span class="field-label">Your Gender:</span>
            <select id="gender">
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Non-binary">Non-binary</option>
            </select>
        </div>

        <div class="field">
            <span class="field-label">Your Job/Role (How do you survive?):</span>
            <input type="text" id="job" placeholder="e.g. Salt Merchant, Scrap Mechanic, Desperate Thief...">
        </div>

        <div class="field">
            <span class="field-label">Your Personality:</span>
            <input type="text" id="personality" placeholder="e.g. Quiet and observant, Paranoid but quick, Charismatic liar...">
        </div>

        <div class="field">
            <span class="field-label">Someone you miss (Relationship):</span>
            <input type="text" id="relation" placeholder="e.g. My brother who stayed in the city, A child lost to the heat...">
        </div>

        <div style="margin-top: 10px;">
            <span class="field-label" style="font-size: 10px; color: #555;">GROQ API KEY:</span>
            <input type="password" id="api-key" placeholder="Paste your key here">
        </div>

        <button class="btn-start" onclick="startGame()">Step Into The Dust</button>
    </div>

    <div id="main-game">
        <div id="output"></div>
        <div id="input-container">
            <input type="text" id="user-input" placeholder="Type your action..." onkeypress="if(event.key==='Enter') sendAction()">
            <button onclick="sendAction()" style="background: #ff6600; color: black; border:none; padding: 10px 20px; cursor: pointer; font-weight: bold;">SEND</button>
        </div>
    </div>
</div>

<script>
    let messages = [];

    async function startGame() {
        const key = document.getElementById('api-key').value;
        const job = document.getElementById('job').value;
        const personality = document.getElementById('personality').value;

        if (!key) return alert("Please enter your Groq API Key!");
        if (!job || !personality) return alert("Tell us your Job and Personality first!");

        const charData = {
            gender: document.getElementById('gender').value,
            job: job,
            personality: personality,
            relation: document.getElementById('relation').value || "the ghosts of the past"
        };

        // Initialize the AI GM with the custom traits
        messages = [
            { 
                role: "system", 
                content: `You are the Game Master for a text RPG set in 'The Dry World'â€”a post-apocalyptic earth where water has vanished. 
                The sun is brutal, oceans are salt-flats, and civilizations are just scrap piles.
                
                PLAYER PROFILE:
                - Gender: ${charData.gender}
                - Job: ${charData.job}
                - Personality: ${charData.personality}
                - Motivation/Relation: They are driven by the memory of ${charData.relation}.

                GAMEPLAY RULES:
                1. Focus on the heat, the thirst, and the crunch of sand. 
                2. Respond with 1-2 paragraphs of vivid narration.
                3. Keep the player's personality in mind when describing how NPCs react to them.
                4. End every turn with 3 distinct choices: [A], [B], and [C].
                5. Do NOT take actions for the player.`
            },
            { role: "user", content: "The wind is howling. Start my story." }
        ];

        document.getElementById('creator-screen').style.display = 'none';
        document.getElementById('main-game').style.display = 'flex';
        runAI();
    }

    async function sendAction() {
        const input = document.getElementById('user-input');
        if (!input.value.trim()) return;

        const val = input.value;
        appendMessage("> " + val, "user-text");
        messages.push({ role: "user", content: val });
        input.value = "";

        runAI();
    }

    async function runAI() {
        const apiKey = document.getElementById('api-key').value;
        try {
            const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: "llama-3.3-70b-versatile",
                    messages: messages,
                    temperature: 0.8
                })
            });

            const data = await response.json();
            const aiText = data.choices[0].message.content;
            
            appendMessage(aiText, "ai-text");
            messages.push({ role: "assistant", content: aiText });
        } catch (err) {
            appendMessage("[ERROR]: Key rejected or network down.", "system-msg");
        }
    }

    function appendMessage(text, className) {
        const div = document.createElement('div');
        div.className = className;
        div.innerText = text;
        const out = document.getElementById('output');
        out.appendChild(div);
        out.scrollTop = out.scrollHeight;
    }
</script>

</body>
</html>
