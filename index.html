<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>THE DRY WORLD - AI RPG</title>
    <style>
        body { background: #1a0f00; color: #d4a373; font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        #game-window { width: 90%; max-width: 800px; height: 90%; border: 2px solid #6b4423; background: #000; display: flex; flex-direction: column; box-shadow: 0 0 30px #4e342e; }
        
        /* Character Creator Styles */
        #creator-screen { padding: 40px; display: flex; flex-direction: column; gap: 20px; overflow-y: auto; }
        .creator-title { font-size: 24px; color: #ff6600; text-align: center; text-transform: uppercase; letter-spacing: 5px; }
        .option-group { display: flex; flex-direction: column; gap: 10px; border-left: 3px solid #333; padding-left: 15px; }
        select, input[type="text"] { background: #111; border: 1px solid #6b4423; color: #d4a373; padding: 10px; cursor: pointer; }
        
        /* Main Game Styles */
        #main-game { display: none; flex-direction: column; height: 100%; }
        #output { flex-grow: 1; overflow-y: auto; padding: 20px; line-height: 1.6; border-bottom: 1px solid #333; }
        #input-container { padding: 15px; display: flex; gap: 10px; background: #0a0a0a; }
        #user-input { flex-grow: 1; background: #000; border: 1px solid #ff6600; color: #fff; padding: 12px; outline: none; }
        
        .btn-main { background: #ff6600; color: #000; border: none; padding: 15px; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        .btn-main:hover { background: #fff; }
        
        .user-text { color: #5bc0de; font-weight: bold; margin-top: 15px; border-left: 2px solid #5bc0de; padding-left: 10px; }
        .ai-text { margin-bottom: 20px; }
        #api-area { font-size: 10px; padding: 10px; background: #111; color: #444; }
    </style>
</head>
<body>

<div id="game-window">
    <div id="creator-screen">
        <div class="creator-title">The World is Dust</div>
        <p style="text-align: center; font-size: 14px;">The water vanished fifty years ago. Who are you in the wasteland?</p>
        
        <div class="option-group">
            <label>Gender:</label>
            <select id="gender">
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Non-binary">Non-binary</option>
            </select>
        </div>

        <div class="option-group">
            <label>Job (What do you do to survive?):</label>
            <select id="job">
                <option value="Water-Witch (Scavenges moisture)">Water-Witch</option>
                <option value="Sand-Runner (Courier)">Sand-Runner</option>
                <option value="Scrap-Hunter (Engineer)">Scrap-Hunter</option>
                <option value="Nomad Guard (Fighter)">Nomad Guard</option>
            </select>
        </div>

        <div class="option-group">
            <label>Relationship (Who do you miss?):</label>
            <input type="text" id="relation" placeholder="e.g. A lost daughter, a rival merchant...">
        </div>

        <div class="option-group">
            <label>Personality:</label>
            <select id="personality">
                <option value="Cynical and Bitter">Cynical & Bitter</option>
                <option value="Hopeless Dreamer">Hopeless Dreamer</option>
                <option value="Ruthless Survivor">Ruthless Survivor</option>
            </select>
        </div>

        <div id="api-area">
            <input type="password" id="api-key" placeholder="PASTE GROQ API KEY HERE" style="width: 100%;">
        </div>

        <button class="btn-main" onclick="startGame()">Start Journey</button>
    </div>

    <div id="main-game">
        <div id="output"></div>
        <div id="input-container">
            <input type="text" id="user-input" placeholder="What is your move?..." onkeypress="if(event.key==='Enter') sendAction()">
            <button onclick="sendAction()" style="background: #ff6600; color: black; border:none; padding: 10px 20px; cursor: pointer;">SEND</button>
        </div>
    </div>
</div>

<script>
    let messages = [];

    async function startGame() {
        const key = document.getElementById('api-key').value;
        if (!key) return alert("You need a Groq API Key to play!");

        // Collect Character Data
        const charData = {
            gender: document.getElementById('gender').value,
            job: document.getElementById('job').value,
            relation: document.getElementById('relation').value || "Nobody left",
            personality: document.getElementById('personality').value
        };

        // Initialize AI Instructions
        messages = [
            { 
                role: "system", 
                content: `You are the Game Master for a text RPG set in 'The Dry World'â€”a post-apocalyptic earth where water is gone and everything is scorched desert.
                
                PLAYER CHARACTER:
                - Gender: ${charData.gender}
                - Job: ${charData.job}
                - Key Relationship: ${charData.relation}
                - Personality: ${charData.personality}

                RULES:
                1. Use gritty, sensory language (heat, dust, thirst).
                2. Never play for the player.
                3. Keep responses under 150 words.
                4. End every post with 3 short choices (A, B, C).
                5. If the player mentions their relationship, make it emotional.`
            },
            { role: "user", content: "I am ready. Describe the opening scene of my journey." }
        ];

        // Switch Screens
        document.getElementById('creator-screen').style.display = 'none';
        document.getElementById('main-game').style.display = 'flex';

        // Call AI for the first time
        runAI();
    }

    async function sendAction() {
        const input = document.getElementById('user-input');
        if (!input.value.trim()) return;

        const val = input.value;
        appendMessage("> " + val, "user-text");
        messages.push({ role: "user", content: val });
        input.value = "";

        runAI();
    }

    async function runAI() {
        const apiKey = document.getElementById('api-key').value;
        try {
            const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: "llama-3.3-70b-versatile",
                    messages: messages
                })
            });

            const data = await response.json();
            const aiText = data.choices[0].message.content;
            
            appendMessage(aiText, "ai-text");
            messages.push({ role: "assistant", content: aiText });
        } catch (err) {
            appendMessage("[CONNECTION ERROR]: Check your key or internet.", "system-msg");
        }
    }

    function appendMessage(text, className) {
        const div = document.createElement('div');
        div.className = className;
        div.innerText = text;
        const out = document.getElementById('output');
        out.appendChild(div);
        out.scrollTop = out.scrollHeight;
    }
</script>

</body>
</html>
