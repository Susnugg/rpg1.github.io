<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Text RPG (Groq Powered)</title>
    <style>
        body { background: #050505; color: #00ffcc; font-family: 'Consolas', monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        #game-window { width: 90%; max-width: 800px; height: 85%; border: 1px solid #00ffcc; display: flex; flex-direction: column; background: #000; box-shadow: 0 0 20px #004433; }
        #output { flex-grow: 1; overflow-y: auto; padding: 20px; line-height: 1.6; white-space: pre-wrap; border-bottom: 1px solid #111; }
        #input-container { padding: 15px; display: flex; gap: 10px; background: #0a0a0a; }
        input { flex-grow: 1; background: #000; border: 1px solid #00ffcc; color: #fff; padding: 12px; outline: none; }
        button { background: #00ffcc; color: #000; border: none; padding: 10px 25px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #fff; }
        .user-text { color: #ffcc00; margin-top: 15px; font-weight: bold; }
        .system-msg { color: #666; font-style: italic; margin-bottom: 10px; }
        #settings { padding: 8px; font-size: 11px; color: #444; display: flex; align-items: center; gap: 10px; }
    </style>
</head>
<body>

<div id="game-window">
    <div id="output">
        <div class="system-msg">[SYSTEM]: 1. Paste your Groq Key below. 2. Type "Start" to begin.</div>
    </div>
    <div id="input-container">
        <input type="text" id="user-input" placeholder="What do you do?..." onkeypress="if(event.key==='Enter') sendAction()">
        <button onclick="sendAction()">SEND</button>
    </div>
    <div id="settings">
        <input type="password" id="api-key" placeholder="Paste Groq API Key" style="width: 200px; height: 15px; border: 1px solid #222;">
        <span>Model: llama-3.3-70b-versatile</span>
    </div>
</div>

<script>
    let messages = [
        { role: "system", content: "You are a professional RPG Game Master. Describe rooms, items, and NPCs vividly but keep it to one paragraph. Track player HP (start at 20). If the player takes an action that is risky, determine if it succeeds. End every response with 3 possible choices: A, B, and C." }
    ];

    async function sendAction() {
        const userInput = document.getElementById('user-input');
        const apiKey = document.getElementById('api-key').value;
        if (!apiKey) return alert("Please enter your Groq API Key in the box at the bottom!");
        if (!userInput.value.trim()) return;

        const text = userInput.value;
        appendMessage("> " + text, "user-text");
        userInput.value = "";

        messages.push({ role: "user", content: text });

        try {
            const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: "llama-3.3-70b-versatile",
                    messages: messages,
                    temperature: 0.7
                })
            });

            const data = await response.json();
            
            if (data.error) {
                appendMessage("[ERROR]: " + data.error.message, "system-msg");
                return;
            }

            const aiText = data.choices[0].message.content;
            appendMessage(aiText, "ai-text");
            messages.push({ role: "assistant", content: aiText });
        } catch (err) {
            appendMessage("[CONNECTION ERROR]: Make sure you are connected to the internet and your key is correct.", "system-msg");
        }
    }

    function appendMessage(text, className) {
        const div = document.createElement('div');
        div.className = className;
        div.innerText = text;
        const output = document.getElementById('output');
        output.appendChild(div);
        output.scroll({ top: output.scrollHeight, behavior: 'smooth' });
    }
</script>

</body>
</html>
